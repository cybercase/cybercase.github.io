<!doctype html><html lang=""><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="C++ Smart Pointer for Debugging"><meta property="og:title" content="Debug Pointer"><meta property="og:site_name" content="Stefano Brilli Home Page"><meta property="og:type" content="article"><meta property="og:locale" content="en_US"><link rel="canonical" href="http://examples.opengraphprotocol.us/article-utc.html"><meta property="og:url" content="http://examples.opengraphprotocol.us/article-utc.html"><meta property="article:author" content="Stefano Brilli"><title>Debug Pointer</title><link href="https://fonts.googleapis.com/css?family=Roboto:400,100italic,100,300,900" rel="stylesheet" type="text/css"><link href="https://fonts.googleapis.com/css?family=Noto+Serif:400,400italic,700" rel="stylesheet" type="text/css"><link href="https://fonts.googleapis.com/css?family=Roboto+Mono:300" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/styles/vendor-a3db57aa98.css"><link rel="stylesheet" href="/styles/main-7762a834ca.css"></head><body><div class="container"><header class="header"><nav class="header-links"><div class="header-links-home"><a href="/">Home</a></div><div class="header-links-articles"><a href="/blog">Writings</a></div></nav></header><article class="content blog-article" lang="en"><h1 id="debug-pointer">Debug Pointer</h1><p>As I mentioned in the last post, lately I’m working on a C++/Boost software (aka speeding up and refactoring an unmaintainable software). This software is just a kind of parser. It parses several binary files and, for each one, produces a xml file. Also it needs to merge and summarise some of the fields contained in each one of these files to produce a <em>Final Report</em> xml file.</p><p>There may be several way to write a software for a task like this, and the customer choosed to use threads. A big mistake, because (IMHO) Who wrote the software did not have any idea of how use threads efficently, and he ended up using a lot of locks and semaphores everywhere… but this is another story.</p><p>The most impressive thing that I saw in this software was the inconsiderate abuse of Boost shared pointers. These were used almost everywhere in the software in every nonsense way they could be used… passing them around by copy or just like the following:</p><pre><code><span class="hljs-keyword">for</span> (int i=<span class="hljs-number">0</span>; i&lt;SOMEINT; ++i) {
    <span class="hljs-regexp">//</span> Why <span class="hljs-symbol">not:</span> SOMECLASS sp; ???
    <span class="hljs-symbol">boost:</span><span class="hljs-symbol">:shared_ptr&lt;SOMECLASS&gt;</span> sp(new SOMECLASS);
    sp-&gt;SomeMethod();
}
</code></pre><p>Just by fixing these kind of misuses, I’ve got a speedup of over 2x.</p><p>Shared pointers can be really useful but they:</p><ul><li>should be used with care because they can become really expensive</li><li>should not be used just to avoid thinking about memory management in your software</li></ul><p>And the last point is the one that I felt was the case of this software. For this reason, and for helping myself to refactor and remove shared pointers from this software, I wrote my own smart pointer: <strong>debug_ptr</strong>.</p><p><strong>debug_ptr</strong> is a smart pointer that should help the developer to manage the memory correctly (a delete for every new). A debug_ptr just warn the developer when he forgets to delete an dynamically allocated object, so that he can insert the correct delete (or <code>delete[]</code>) statement. Also, debug_ptr is designed in a way such that, once you have tested your software and no memory leaks warning are raised anymore, it can be automatically substituted with a native pointer type, so that no overhead is added both at run and compile time.</p><p>For now you can check the debug_ptr source code and have a look at the few test cases that show how it can be used. It’s located in my debug_ptr repository on github:</p><pre><code>git <span class="hljs-built_in">clone</span> git://github.com/cybercase/debug_ptr.git <span class="hljs-comment"># clone the repo</span>
<span class="hljs-built_in">cd</span> debug_ptr
g++ -Wall -o <span class="hljs-built_in">test</span> debug_ptr_test.cc -DENABLE_DEBUG_TYPES
./<span class="hljs-built_in">test</span>
</code></pre><p>In the next post, I’ll try to focus on some interesting parts of this very simple smart pointer.</p><p><em>–22/08/2012</em></p></article><footer class="footer"><div>© 2016 Stefano Brilli. All Rights Reserved.</div><div><a id="toggle-grid" href="#">toggle grid</a></div></footer></div><!-- Google Analytics: change UA-XXXXX-X to be your site's ID. --><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
      function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='https://www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
      ga('create','UA-60498490-1');ga('send','pageview');</script><script src="/scripts/vendor-4637e41d8f.js"></script><script src="/scripts/main-398d21b2c9.js"></script><script>hljs.initHighlightingOnLoad();</script></body></html>