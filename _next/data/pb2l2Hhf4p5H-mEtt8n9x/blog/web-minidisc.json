{"pageProps":{"post":{"slug":"web-minidisc","title":"The Web MiniDisc Application - Use your old NetMD device in the browser","description":"Get control of your MiniDisc device thanks to WebUSB and WASM","date":"2020-03-26T05:35:07.322Z","coverImage":"/images/minidisc.jpg","coverTitle":"The Web MiniDisc App","coverSubtitle":"Bringing back to life the MiniDisc with WebUSB and WASM","coverDark":true,"content":"<p>If you’ve never heard of the MiniDisc don’t worry, you’re not alone.</p>\n<p>If you’re curious, you can catch up by reading the <a href=\"https://en.wikipedia.org/wiki/MiniDisc\">Wikipedia page</a>,\nor the old community portal <a href=\"http://www.minidisc.org/\">minidisc.org</a>, or interact with the reddit community of <a href=\"https://reddit.com/r/minidisc\">/r/minidisc</a>.</p>\n<p>If you’re not, long story short, it’s a dead music format released by Sony at the beginning of the ’90s, that was slowly killed\nby the popularity of the many MP3 players that started coming out in the early 2000s.</p>\n<p>Some of the last MiniDisc players, branded as <em>NetMD</em> units, were equipped with a USB port that allowed for recording music onto the device by using the infamously SonicStage software (Windows only, of course).\nWhen Sony abandoned the MiniDisc, that software was left unmaintained and, nowadays, it can’t run outside virtual machines or without using dangerously unsigned drivers.</p>\n<p>Luckily the OSS community managed to completely reverse engineer the NetMD protocol and, before the death of the MiniDisc, the <a href=\"https://wiki.physik.fu-berlin.de/linux-minidisc/doku.php\">linux-minidisc</a> project was released.</p>\n<p>A few of weeks ago, just before the infamously Coronavirus lockdown here in Italy, I’ve been lucky enough to find my old <a href=\"https://www.minidisc.org/part_Sony_MZ-N710.html\">MZ-N710</a> in my parents’ basement.\nDetermined to make it work on my Macbook, I brought it home and successfully managed to compile and run the linux-minidisc CLI.</p>\n<h2>Porting the MiniDisc to Web</h2>\n<p>The process for uploading the music via the CLI was comprised of 2 steps:</p>\n<ol>\n<li>Convert your music</li>\n</ol>\n<ul>\n<li>Use <code>ffmpeg</code> <sup><a href=\"#ffmpeg\">[1]</a></sup> to create a 16bit 44100Hz pcm wav file (SP quality)</li>\n<li>Use <code>atrac3denc</code> <sup><a href=\"#atracdenc\">[2]</a></sup> to create a 132/66 Kbit ATRAC3 file (LP2/LP4 quality)</li>\n</ul>\n<ol start=\"2\">\n<li>Use the CLI to send the converted music to the device</li>\n</ol>\n<p>Not the most <em>user friendly</em> process for those who’re not fancy to type commands in a terminal.</p>\n<p>So, after pondering for a while, I realized these steps could have been encapsulated in a <em>no-install-required</em>\nprogressive web app, for a considerable step up in the ease of the process.</p>\n<p>I would just use:</p>\n<ul>\n<li><strong>WebUSB</strong><sup><a href=\"#webusb\">[8]</a></sup> to replace the CLI for communicating with the NetMD device</li>\n<li><strong>emscripten</strong><sup><a href=\"#emscripten\">[9]</a></sup> to bring <code>ffmpeg</code> and <code>atracdenc</code> into the browser</li>\n<li><strong>React</strong><sup><a href=\"#reacjs\">[10]</a></sup> to create a simple UI</li>\n</ul>\n<h3>1. Writing a library</h3>\n<p>I started by porting the code from linux-minidisc to a new JS library that I’ve now published on npm, called <code>netmd-js</code><sup><a href=\"#netmdjs\">[3]</a></sup>.</p>\n<p>This library implements the NetMD protocol and takes care of the USB communication with the device.\nIt will also allow other devs to write their own app, should mine not suit their needs.</p>\n<p>It runs either in <code>nodejs</code> and in every browser supporting the WebUSB standard, and uses <em>Worker Threads</em><sup><a href=\"#workerthreads\">[4]</a></sup> or\n<em>Web Workers</em><sup><a href=\"#webworkers\">[5]</a></sup> to speed up the\nmusic encryption step required by the protocol. The encryption has been implemented on top of <em>CryptoJS</em><sup><a href=\"#cryptojs\">[6]</a></sup>.</p>\n<h3>2. Using emscripten</h3>\n<p>I was lucky enough to find a project called <code>ffmpeg.js</code><sup><a href=\"#ffmpegjs\">[7]</a></sup> that already ported ffmpeg to WASM.\nSo, the only thing left to do was to configure it properly and recompile, just to trim down the binary size.\nA full tutorial is available in the GitHub page of <code>ffmpeg.js</code>.</p>\n<p>Then, I’ve followed a similar process to cross compile the <code>atracdenc</code> encoder and eventually write a simple JS wrapper around it.</p>\n<h3>3. The Web MiniDisc Application</h3>\n<p>After gathering all the bricks together, I’ve shifted my focus to design the app’s user interface and experience.</p>\n<div class=\"mtop-1-m mtop-1-d line-21-d\" style=\"text-align: center;\">\n    <img src=\"/images/webminidiscapp.png\" alt=\"Web MiniDisc App Wireframe\" style=\"width: 100%;\"/>\n</div>\n<blockquote>\n<p><em>A dead simple user experience</em></p>\n</blockquote>\n<p>Then I started off with the classic <em>create react app + TypeScript</em> template, and added <em>redux</em> and <em>material-ui</em> components… a <em>no-frills</em> setup.</p>\n<h2>How to use a NetMD device in 2020</h2>\n<p>A couple of nights later I was ready to record the first demo of the the Web MiniDisc Application.</p>\n<p>It has been exciting to see the app work seamlessly both on my Macbook and on my Android phone without an <code>if</code> needed.</p>\n<iframe class=\"line-17-d line-11-m\" src=\"//www.youtube.com/embed/Frs8qhw0g9Y\" frameborder=\"0\" allowfullscreen></iframe>\n<h3>Public launch</h3>\n<p>Honestly, there aren’t many places to launch a MiniDisc app in 2020 :)<br/>\nIt’s a pretty tiny niche.</p>\n<p>However, I have been lurking for some time in <a href=\"https://www.reddit.com/r/minidisc/\">/r/minidisc</a> and decided to start from there.\n<a href=\"https://www.reddit.com/r/minidisc/comments/fn4acd/web_minidisc_application/\">The feedback was great</a>, and people even responded with a few bug reports and feature requests.</p>\n<h3>Links</h3>\n<p>If you’re a lucky owner of a NetMD device, you can try the app yourself at</p>\n<p><a href=\"https://stefano.brilli.me/webminidisc/\" target=\"_blank\"><a href=\"https://stefano.brilli.me/webminidisc/\">https://stefano.brilli.me/webminidisc/</a></a></p>\n<p>Or, if you just want to browse the code, everything’s available on GitHub.</p>\n<p><a href=\"https://github.com/cybercase/webminidisc\" target=\"_blank\"><a href=\"https://github.com/cybercase/webminidisc\">https://github.com/cybercase/webminidisc</a></a></p>\n<h3>References</h3>\n<ol>\n<li>FFmpeg, <a href=\"https://ffmpeg.org/\" target=\"_blank\" id=\"ffmpeg\"><a href=\"https://ffmpeg.org/\">https://ffmpeg.org/</a></a></li>\n<li>atracdenc, <a href=\"https://github.com/dcherednik/atracdenc\" target=\"_blank\" id=\"atracdenc\"><a href=\"https://github.com/dcherednik/atracdenc\">https://github.com/dcherednik/atracdenc</a></a></li>\n<li>netmd-js, <a href=\"https://github.com/cybercase/netmd-js\" target=\"_blank\" id=\"netmdjs\"><a href=\"https://github.com/cybercase/netmd-js\">https://github.com/cybercase/netmd-js</a></a></li>\n<li>Worker Threads, <a href=\"https://nodejs.org/api/worker_threads.html\" target=\"_blank\" id=\"workerthreads\"><a href=\"https://nodejs.org/api/worker_threads.html\">https://nodejs.org/api/worker_threads.html</a></a></li>\n<li>Web Workers, <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers\" target=\"_blank\" id=\"webworkers\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers\">https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers</a></a></li>\n<li>CryptoJS, <a href=\"https://code.google.com/archive/p/crypto-js/\" target=\"_blank\" id=\"cryptojs\"><a href=\"https://code.google.com/archive/p/crypto-js/\">https://code.google.com/archive/p/crypto-js/</a></a></li>\n<li>ffmpeg.js, <a href=\"https://github.com/ffmpegjs/ffmpeg.js\" target=\"_blank\" id=\"ffmpegjs\"><a href=\"https://github.com/ffmpegjs/ffmpeg.js\">https://github.com/ffmpegjs/ffmpeg.js</a></a></li>\n<li>WebUSB, <a href=\"https://wicg.github.io/webusb/\" target=\"_blank\" id=\"webusb\"><a href=\"https://wicg.github.io/webusb/\">https://wicg.github.io/webusb/</a></a></li>\n<li>emscripten, <a href=\"https://emscripten.org/\" target=\"_blank\" id=\"emscripten\"><a href=\"https://emscripten.org/\">https://emscripten.org/</a></a></li>\n<li>React, <a href=\"https://reactjs.org/\" target=\"_blank\" id=\"reacjs\"><a href=\"https://reactjs.org/\">https://reactjs.org/</a></a></li>\n</ol>\n<p><em>— 26/03/2020</em></p>"}},"__N_SSG":true}